import{Z as ne,f as oe,T as se,E as re}from"./style-j1KSkW1o.js";import{k as ie}from"./katex.min-0MFFjn28.js";import{d as ue,s as de,g as d,q as ce,h as me,a as _,b as t,i as a,j as o,k as m,l as B,E as p,f as c,F as g,r as V,t as E,o as h,p as I}from"./index-BeiLAd8h.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"mathquill-container"},ve={class:"header"},xe={class:"actions"},_e={class:"editor-wrapper"},he={class:"mathquill-dialog"},we={class:"editor-section"},ye={class:"template-section"},Ce={class:"template-section"},be={class:"template-section"},ke={class:"template-section"},Me={class:"output-section"},Qe={class:"render-preview"},ge={class:"preview"},Ve=["innerHTML"],Ee=ue({__name:"6MathQuillView",setup(Te){ne.registerModule(oe);const w=de(),f=d("<p>欢迎使用富文本编辑器！点击上方按钮插入 MathQuill 公式。</p>"),y=d(""),T=d(),F=d("default"),v=d(null),C=d(),b=d();let r=null,k=null;const x=d(!1),i=d(""),L=d("common"),j=[{latex:"\\frac{\\dot{V}_A}{\\dot{Q}}",name:"通气血流比"},{latex:"\\dot{V}_A = 4.2\\text{ L/min}",name:"肺泡通气量"},{latex:"\\dot{Q} = 5.0\\text{ L/min}",name:"肺血流量"},{latex:"\\frac{\\dot{V}_A}{\\dot{Q}} \\approx 0.8",name:"正常V̇A/Q̇比值"},{latex:"\\frac{\\dot{V}_A}{\\dot{Q}} = 0",name:"分流状态"},{latex:"\\frac{\\dot{V}_A}{\\dot{Q}} = \\infty",name:"死腔状态"},{latex:"Q_s = 5.0\\text{ L/min}",name:"心输出量"},{latex:"P_{O_2} = 40\\text{ mmHg}",name:"静脉血氧分压"},{latex:"P_{CO_2}",name:"二氧化碳分压"}],R=[{latex:"\\text{BMI} = \\frac{\\text{体重}}{\\text{身高}^2}",name:"BMI指数"},{latex:"\\text{MAP} = \\text{DBP} + \\frac{1}{3}(\\text{SBP} - \\text{DBP})",name:"平均动脉压"},{latex:"\\text{CO} = \\text{HR} \\times \\text{SV}",name:"心输出量"}],S=[{latex:"E = mc^2",name:"质能方程"},{latex:"F = ma",name:"牛顿第二定律"},{latex:"a^2 + b^2 = c^2",name:"勾股定理"}],H=[{latex:"\\frac{a}{b}",name:"分数"},{latex:"\\sqrt{x}",name:"平方根"},{latex:"x^{n}",name:"幂"},{latex:"\\int_{a}^{b} f(x) dx",name:"定积分"},{latex:"\\sum_{i=1}^{n} x_i",name:"求和"}],N={excludeKeys:[]},O={placeholder:"请输入内容...",MENU_CONF:{}},U=()=>new Promise(s=>{if(window.MathQuill){v.value=window.MathQuill.getInterface(2),s(!0);return}const e=document.createElement("script");e.src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js",e.onload=()=>{const n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.bootcdn.net/ajax/libs/mathquill/0.10.1/mathquill.min.css",document.head.appendChild(n);const u=document.createElement("script");u.src="https://cdn.bootcdn.net/ajax/libs/mathquill/0.10.1/mathquill.min.js",u.onload=()=>{v.value=window.MathQuill.getInterface(2),p.success("MathQuill 加载成功"),s(!0)},document.body.appendChild(u)},document.body.appendChild(e)}),z=()=>{!C.value||!v.value||(C.value.innerHTML="",r=v.value.MathField(C.value,{spaceBehavesLikeTab:!0,handlers:{edit:()=>{r&&(i.value=r.latex(),M())}}}),r.latex("f(x) = \\frac{1}{\\sqrt{2\\pi}} e^{-\\frac{x^2}{2}}"),i.value=r.latex(),M())},D=()=>{!b.value||!v.value||(b.value.innerHTML="",k=v.value.StaticMath(b.value))},M=()=>{k&&i.value&&k.latex(i.value)},$=()=>{r&&r.latex(i.value),M()},Q=s=>{r&&(r.latex(s),i.value=s,r.focus(),M())},X=()=>{x.value=!0,I(()=>{r||(z(),D())})},Z=()=>{if(!i.value.trim()){p.warning("请输入公式");return}const s=w.value;if(s)try{const e=s,n={type:"formula",value:i.value,children:[{text:""}]};e.insertNode(n),x.value=!1,p.success("公式已插入")}catch(e){console.error("插入公式失败:",e),p.error("插入失败，请重试")}},K=s=>{w.value=s,p.success("编辑器加载完成")},P=()=>{T.value&&I(()=>{try{T.value.querySelectorAll('span[data-w-e-type="formula"]').forEach(e=>{const n=e.getAttribute("data-value");if(n)try{ie.render(n,e,{throwOnError:!1,displayMode:!e.hasAttribute("data-w-e-is-inline")})}catch(u){console.error("公式渲染错误:",u,"公式:",n),e.textContent=n}})}catch(s){console.error("公式渲染过程出错:",s)}})},W=()=>{y.value=f.value,P(),p.success("内容已更新到预览区域"),console.log("编辑器内容：",f.value)},G=()=>{const s=`
    <h2>这是一个示例标题</h2>
    <p>这是一段示例文本，展示了富文本编辑器的基本功能。</p>
    <p>数学公式示例：<span data-w-e-type="formula" data-w-e-is-void data-w-e-is-inline data-value="E=mc^2"></span></p>
    <p>通气血流比：<span data-w-e-type="formula" data-w-e-is-void data-w-e-is-inline data-value="\\frac{\\dot{V}_A}{\\dot{Q}} \\approx 0.8"></span></p>
  `;f.value=s,y.value=s,P(),p.success("已设置示例内容")},J=()=>{f.value="",y.value="",p.info("内容已清空")};return ce(async()=>{await U()}),me(()=>{const s=w.value;s!=null&&(s.destroy(),r=null,k=null)}),(s,e)=>{const n=m("el-button"),u=m("el-tab-pane"),Y=m("el-tabs"),A=m("el-col"),ee=m("el-input"),te=m("el-row"),le=m("el-dialog"),ae=m("el-card");return h(),_("div",fe,[t("div",ve,[e[9]||(e[9]=t("h2",null,"富文本编辑器 (WangEditor + MathQuill)",-1)),e[10]||(e[10]=t("p",{class:"subtitle"},"集成 MathQuill 的交互式数学公式编辑能力",-1)),t("div",xe,[a(n,{type:"primary",onClick:W},{default:o(()=>[...e[5]||(e[5]=[c("获取内容",-1)])]),_:1}),a(n,{onClick:G},{default:o(()=>[...e[6]||(e[6]=[c("设置示例",-1)])]),_:1}),a(n,{onClick:J},{default:o(()=>[...e[7]||(e[7]=[c("清空",-1)])]),_:1}),a(n,{type:"success",onClick:X},{default:o(()=>[...e[8]||(e[8]=[t("span",{style:{"font-size":"16px","font-weight":"bold"}},"∑",-1),c(" 插入公式 ",-1)])]),_:1})])]),t("div",_e,[a(B(se),{style:{"border-bottom":"1px solid #ccc"},editor:w.value,defaultConfig:N,mode:F.value},null,8,["editor","mode"]),a(B(re),{style:{height:"300px","overflow-y":"hidden"},modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),defaultConfig:O,mode:F.value,onOnCreated:K},null,8,["modelValue","mode"])]),a(le,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=l=>x.value=l),title:"插入数学公式 (MathQuill)",width:"1000px","close-on-click-modal":!1},{footer:o(()=>[a(n,{onClick:e[3]||(e[3]=l=>x.value=!1)},{default:o(()=>[...e[15]||(e[15]=[c("取消",-1)])]),_:1}),a(n,{type:"primary",onClick:Z},{default:o(()=>[...e[16]||(e[16]=[c("确定插入",-1)])]),_:1})]),default:o(()=>[t("div",he,[a(te,{gutter:20},{default:o(()=>[a(A,{span:14},{default:o(()=>[t("div",we,[e[11]||(e[11]=t("h4",null,"公式编辑器：",-1)),t("div",{ref_key:"mathQuillEditorRef",ref:C,class:"mathquill-wrapper"},null,512),e[12]||(e[12]=t("div",{class:"editor-tips"},[t("p",null,[t("strong",null,"提示：")]),t("ul",null,[t("li",null,"点击编辑器开始输入数学公式"),t("li",null,"使用 Tab 键在占位符间切换"),t("li",null,"支持键盘输入 LaTeX 语法")])],-1))]),a(Y,{modelValue:L.value,"onUpdate:modelValue":e[1]||(e[1]=l=>L.value=l),type:"card",class:"template-tabs"},{default:o(()=>[a(u,{label:"常用",name:"common"},{default:o(()=>[t("div",ye,[(h(),_(g,null,V(S,l=>a(n,{key:l.latex,size:"small",onClick:q=>Q(l.latex)},{default:o(()=>[c(E(l.name),1)]),_:2},1032,["onClick"])),64))])]),_:1}),a(u,{label:"呼吸生理学",name:"respiratory"},{default:o(()=>[t("div",Ce,[(h(),_(g,null,V(j,l=>a(n,{key:l.latex,size:"small",onClick:q=>Q(l.latex)},{default:o(()=>[c(E(l.name),1)]),_:2},1032,["onClick"])),64))])]),_:1}),a(u,{label:"医学",name:"medical"},{default:o(()=>[t("div",be,[(h(),_(g,null,V(R,l=>a(n,{key:l.latex,size:"small",onClick:q=>Q(l.latex)},{default:o(()=>[c(E(l.name),1)]),_:2},1032,["onClick"])),64))])]),_:1}),a(u,{label:"数学",name:"math"},{default:o(()=>[t("div",ke,[(h(),_(g,null,V(H,l=>a(n,{key:l.latex,size:"small",onClick:q=>Q(l.latex)},{default:o(()=>[c(E(l.name),1)]),_:2},1032,["onClick"])),64))])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(A,{span:10},{default:o(()=>[t("div",Me,[e[13]||(e[13]=t("h4",null,"LaTeX 代码：",-1)),a(ee,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),type:"textarea",rows:4,onInput:$},null,8,["modelValue"]),e[14]||(e[14]=t("h4",{style:{"margin-top":"16px"}},"渲染预览：",-1)),t("div",Qe,[t("div",{ref_key:"previewRef",ref:b,class:"preview-math"},null,512)])])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),t("div",ge,[e[17]||(e[17]=t("h3",null,"内容预览：",-1)),a(ae,null,{default:o(()=>[t("div",{ref_key:"contentPreviewRef",ref:T,innerHTML:y.value},null,8,Ve)]),_:1})])])}}}),Ae=pe(Ee,[["__scopeId","data-v-e9184634"]]);export{Ae as default};
